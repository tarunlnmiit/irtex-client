<div *ngIf="!hideSearchForm" style="background-color: #f2f2f2; padding: 5px;">
  <div class="container">
    <div style="margin: auto;">
      <app-search-form></app-search-form>
    </div>
  </div>
</div>
<div class="mt-5">
  <div class="container">
    <div>
      <div class="fab">
        <button
          (click)="onCompareButtonClicked()"
          *ngIf="selectedImages.length > 1"
          mat-raised-button
          color="accent"
        >
          Click to Compare
        </button>
      </div>
      <div class="row card2">
        <div *ngIf="query.name" class="col-sm-12">
          <div class="d-flex">
            <div class="p-2 align-self-center">
              <mat-checkbox [disabled]="true"></mat-checkbox>
            </div>
            <div class="p-3">
              <img
                style="max-width: 300px;"
                height="100px"
                src="{{ ImageBaseUrl + query.url }}"
                alt=""
              />
            </div>
            <div class="p-2">
              <h4>Search results for {{ query.name }}</h4>

              <span class="muted"
                >Searching images from the
                {{ dataset | uppercase }} dataset</span
              >
              <p
                *ngIf="results.length > 0"
                class="font-weight-bold"
                [hidden]="results.length == 0"
              >
                {{ results.length }} results retrieved
              </p>
              <div>
                <mat-progress-bar
                  [hidden]="hideExplanationSpinner"
                  mode="indeterminate"
                ></mat-progress-bar>

                <p
                  [hidden]="!hideExplanationSpinner"
                  class="alert alert-primary"
                >
                  {{ globalExplanation }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div [hidden]="error == ''" class="mt-4 alert alert-danger" role="alert">
        {{ error }}
      </div>
      <div style="margin: auto; width: 100px;">
        <mat-progress-spinner
          [hidden]="hideSpinner"
          mode="indeterminate"
          value="66"
          diameter="45"
        ></mat-progress-spinner>
      </div>
      <div class="mt-4 d-flex">
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Rank By</mat-label>
            <mat-select [value]="selectedFeature">
              <mat-option
                [value]="f"
                (onSelectionChange)="onRankByChanged($event)"
                *ngFor="let f of features"
                >{{ f }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
        <div class="ml-auto">
          <mat-paginator
            [length]="length"
            [pageSize]="pageSize"
            [pageSizeOptions]="pageSizeOptions"
            (page)="paginateResult($event)"
          >
          </mat-paginator>
        </div>
      </div>
      <div class="">
        <div
          *ngFor="let result of renderedResults; index as i"
          (click)="logUserClick(i)"
          class="row mt-5"
          [id]="i"
        >
          <div class="col-sm-12">
            <div class="d-flex">
              <div class="p-2 align-self-center">
                <mat-checkbox
                  (change)="onImageselect(result.name)"
                ></mat-checkbox>
              </div>
              <div class="p-3">
                <img
                  width="100"
                  class=""
                  src="{{ ImageBaseUrl + result.url }}"
                  alt=""
                />
                <a
                  mat-stroked-button
                  class="self-query mt-2"
                  style="color: darkblue !important;"
                  [href]="
                    'http://localhost:4200/search?session_id=' +
                    sessionId +
                    '&dataset=' +
                    dataset +
                    '&query_url=' +
                    result.url
                  "
                  >Search</a
                >
              </div>
              <div class="p-2 d-flex">
                <div style="min-width: 400px;">
                  <h5>
                    {{ result.name }}
                    <span class="text-muted small">[{{ result.label }}]</span>
                  </h5>

                  <div style="display: block; max-width: 250px;">
                    <div style="font-size: 0.7em;">
                      <span *ngIf="result.similarity_list; else singleScore">
                        <div
                          *ngFor="let feature of features; index as i"
                          class="mb-1"
                        >
                          <span
                            ><mat-label
                              ><span class="feature-name"
                                >{{ feature }}
                                <span class="showOnHover">
                                  {{
                                    i != 0
                                      ? toFloatPercentage(
                                          result.similarity_list[i]
                                        )
                                      : (result.similarity * 100
                                        | number: "1.0-0")
                                  }}
                                </span>
                              </span>
                            </mat-label></span
                          >

                          <mat-progress-bar
                            mode="determinate"
                            [value]="
                              i != 0
                                ? toFloatPercentage(result.similarity_list[i])
                                : result.similarity * 100
                            "
                          ></mat-progress-bar>
                        </div>
                      </span>
                      <ng-template #singleScore>
                        <span>{{ selectedFeature }} </span
                        ><span class="badge badge-primary"
                          >{{
                            result.similarity * 100 | number: "1.0-0"
                          }}
                          %</span
                        >
                      </ng-template>
                    </div>
                  </div>
                </div>
                <div
                  class="p-1"
                  style="
                    border-left: 1px solid #ffffff;
                    font-size: 0.8em;
                    margin-left: 5px;
                  "
                >
                  <button
                    (click)="openDialog(result.url)"
                    class="mt-4"
                    mat-flat-button
                    color="primary"
                  >
                    Explain
                  </button>
                </div>
              </div>
            </div>
            <hr style="width: 80%; margin: auto;" />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
